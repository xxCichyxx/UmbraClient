package net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.other

import net.ccbluex.liquidbounce.event.PacketEvent
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablermodes.DisablerMode
import net.ccbluex.liquidbounce.utils.MinecraftInstance
import net.ccbluex.liquidbounce.value.BoolValue
import net.ccbluex.liquidbounce.value.Value
import net.ccbluex.liquidbounce.script.api.global.Chat
import net.ccbluex.liquidbounce.event.EventTarget
import net.ccbluex.liquidbounce.event.WorldEvent
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.c03NoMoveValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.cancelC00Value
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.cancelC03Value
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.cancelC07Value
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.cancelC0AValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.cancelC0BValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.cancelC0FValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.cancelC13Value
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.debugMessage
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.fakeLagAttackValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.fakeLagBlockValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.fakeLagPosValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.fakeLagSpoofValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.flagMode
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.flagSilent
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.flagTick
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.lagDelayValue
import net.ccbluex.liquidbounce.features.module.modules.exploit.Disabler.lagDurationValue
import net.ccbluex.liquidbounce.utils.MovementUtils
import net.ccbluex.liquidbounce.utils.PacketUtils
import net.ccbluex.liquidbounce.utils.timing.MSTimer
import net.minecraft.network.Packet
import net.minecraft.network.play.INetHandlerPlayServer
import net.minecraft.network.play.client.*
import net.minecraft.network.play.client.C03PacketPlayer.*
import net.minecraft.network.play.server.S08PacketPlayerPosLook
import java.util.*
import kotlin.math.sqrt

object FlagDisabler : DisablerMode("FlagDisabler") {
    override fun onPacket(event: PacketEvent) {
        val packet = event.packet
        if (packet is C03PacketPlayer && flagMode.get().equals("edit", true) && mc.thePlayer.ticksExisted > 0 && mc.thePlayer.ticksExisted % flagTick.get() == 0)
        {
            packet.isMoving = false
            packet.onGround = false
            packet.y = -0.08
        }
        if (packet is S08PacketPlayerPosLook && flagSilent.get()) {
            if (mc.thePlayer == null || mc.thePlayer.ticksExisted <= 0) return

            var x = packet.getX() - mc.thePlayer.posX
            var y = packet.getY() - mc.thePlayer.posY
            var z = packet.getZ() - mc.thePlayer.posZ
            var diff = sqrt(x * x + y * y + z * z)
            if (diff <= 8) {
                event.cancelEvent()
                PacketUtils.sendPacketNoEvent(C06PacketPlayerPosLook(packet.getX(), packet.getY(), packet.getZ(), packet.getYaw(), packet.getPitch(), true))
            }
        }
    }
    override fun onUpdate() {
        if (flagMode.get().equals("packet", true) && mc.thePlayer.ticksExisted > 0 && mc.thePlayer.ticksExisted % flagTick.get() == 0) {
            PacketUtils.sendPacketNoEvent(C04PacketPlayerPosition(mc.thePlayer.posX, -0.08, mc.thePlayer.posZ, mc.thePlayer.onGround))
        }
    }
}